<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Given a tibble/data.frame, you can get information on what happens before, after,
or in both directions of some given event, where the event is defined by some
percentage increase/decrease in values from time t to t+1"><title>Event Analysis — ts_time_event_analysis_tbl • healthyR.ts</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Event Analysis — ts_time_event_analysis_tbl"><meta property="og:description" content="Given a tibble/data.frame, you can get information on what happens before, after,
or in both directions of some given event, where the event is defined by some
percentage increase/decrease in values from time t to t+1"><meta property="og:image" content="https://www.spsanderson.com/healthyR.ts/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">healthyR.ts</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.10.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/getting-started.html">Getting Started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Tidy FFT Analysis</h6>
    <a class="dropdown-item" href="../articles/using-tidy-fft.html">Using tidy_fft</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/spsanderson/healthyR.ts/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Event Analysis</h1>
      <small class="dont-index">Source: <a href="https://github.com/spsanderson/healthyR.ts/blob/HEAD/R/ts-event-analysis-tbl.R" class="external-link"><code>R/ts-event-analysis-tbl.R</code></a></small>
      <div class="d-none name"><code>ts_time_event_analysis_tbl.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Given a tibble/data.frame, you can get information on what happens before, after,
or in both directions of some given event, where the event is defined by some
percentage increase/decrease in values from time <code>t</code> to <code>t+1</code></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ts_time_event_analysis_tbl</span><span class="op">(</span></span>
<span>  <span class="va">.data</span>,</span>
<span>  <span class="va">.date_col</span>,</span>
<span>  <span class="va">.value_col</span>,</span>
<span>  .percent_change <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  .horizon <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  .precision <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  .direction <span class="op">=</span> <span class="st">"forward"</span>,</span>
<span>  .filter_non_event_groups <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>.data</dt>
<dd><p>The date.frame/tibble that holds the data.</p></dd>


<dt>.date_col</dt>
<dd><p>The column with the date value.</p></dd>


<dt>.value_col</dt>
<dd><p>The column with the value you are measuring.</p></dd>


<dt>.percent_change</dt>
<dd><p>This defaults to 0.05 which is a 5% increase in the
<code>.value_col</code>.</p></dd>


<dt>.horizon</dt>
<dd><p>How far do you want to look back or ahead.</p></dd>


<dt>.precision</dt>
<dd><p>The default is 2 which means it rounds the lagged 1 value
percent change to 2 decimal points. You may want more for more finely tuned
results, this will result in fewer groupings.</p></dd>


<dt>.direction</dt>
<dd><p>The default is <code>forward</code>. You can supply either <code>forward</code>,
<code>backwards</code> or <code>both</code>.</p></dd>


<dt>.filter_non_event_groups</dt>
<dd><p>The default is TRUE, this drops groupings with
no events on the rare occasion it does occur.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A tibble.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This takes in a <code>data.frame</code>/<code>tibble</code> of a time series. It requires a date column,
and a value column. You can convert a <code>ts</code>/<code>xts</code>/<code>zoo</code>/<code>mts</code> object into a tibble by
using the <code><a href="ts_to_tbl.html">ts_to_tbl()</a></code> function.</p>
<p>You will provide the function with a percentage change in the form of -1 to 1
inclusive. You then provide a time horizon in which you want to see. For example
you may want to see what happens to <code>AirPassengers</code> after a 0.1 percent increase
in volume.</p>
<p>The next most important thing to supply is the direction. Do you want to see what
typically happens after such an event, what leads up to such an event, or both.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Time_Filtering: 
<code><a href="ts_compare_data.html">ts_compare_data</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Steven P. Sanderson II, MPH</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">df_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="ts_to_tbl.html">ts_to_tbl</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">index</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tst</span> <span class="op">&lt;-</span> <span class="fu">ts_time_event_analysis_tbl</span><span class="op">(</span><span class="va">df_tbl</span>, <span class="va">date_col</span>, <span class="va">value</span>, .direction <span class="op">=</span> <span class="st">"both"</span>,</span></span>
<span class="r-in"><span>.horizon <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">tst</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Rows: 33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Columns: 18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ rowid                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ date_col             <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 1949-02-01, 1949-03-01, 1949-04-01, 1949-05-01, …</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ value                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 118, 132, 129, 121, 135, 148, 148, 199, 184, 162,…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ lag_val              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 112, 118, 132, 129, 121, 135, 148, 199, 199, 184,…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ adj_diff             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 6, 14, -3, -8, 14, 13, 0, 0, -15, -22, -16, 20, 5…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ relative_change_raw  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.05357143, 0.11864407, -0.02272727, -0.06201550,…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ relative_change      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.05, 0.12, -0.02, -0.06, 0.12, 0.10, 0.00, 0.00,…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ pct_chg_mark         <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ event_base_change    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.00000000, 0.11864407, -0.02272727, -0.06201550,…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ group_number         <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ numeric_group_number <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ group_event_number   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ x                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 4, 5, 6, 7, 8, 9, 1…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ mean_event_change    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.00000000, 0.03849647, -0.06815622, -0.04991040,…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ median_event_change  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.00000000, 0.07222222, -0.06217617, -0.06201550,…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ event_change_ci_low  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.00000000, -0.06799693, -0.11669576, -0.09692794…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ event_change_ci_high <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.000000000, 0.116322976, -0.024699717, 0.0073964…</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ event_type           <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> Before, Before, Before, Before, Before, Before, A…</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tst</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">mean_event_change</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">event_change_ci_high</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">event_change_ci_low</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">7</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    title <span class="op">=</span> <span class="st">"'AirPassengers' Event Analysis at 5% Increase"</span>,</span></span>
<span class="r-in"><span>    subtitle <span class="op">=</span> <span class="st">"Vertical Red line is normalized event epoch - Direction: Both"</span>,</span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="st">""</span>,</span></span>
<span class="r-in"><span>    y <span class="op">=</span> <span class="st">"Mean Event Change"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-plt img"><img src="ts_time_event_analysis_tbl-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Steven Sanderson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

